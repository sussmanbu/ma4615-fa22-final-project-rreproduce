---
title: Analysis
description:
toc: true
featuredVideo:
featuredImage: https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg
draft: false
---
```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(corrplot)
library(readr)
library(knitr)
```

**Big Question**
------------
We are curious about the potential relationships between several variables from the migration and crime datasets. Our big question for this project is: 

***What factors affect the immigration status in the United States and how do they affect it?***

The variables we investigated as potential influential factors are：

* Income Quantile (Q1-Poor to Q5-Rich)
* Race (Non-hispanic White and other races)
* Average Robbery and Burglary Rate from 2000-2007 
* Average Robbery and Burglary Rate from 2010-2017

Our hypotheses are:

* States with higher income are more attractive to immigrants.
* Race doesn't affect state's immigration status of the states.
* State income is inversely associated with crime rate.
* States with higher crime rate at early years tend to have more people moving out of their home states.
* States with lower crime in recent years are more attractive to immigrants

**Immigration Status within Massachusetts**
-------
Firstly, we zoom in to look at the migration trend within Massachusetts. The state of Massachusetts can be categorized into five commute zones: Boston, Nantucket, Oak Bluffs, Pittsfield and Springfield. We set the departure commute zone to be Boston. Therefore, we are trying to figure out which commute zone in Massachusetts that Boston people tend to migrate to. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
o_MA <- read_csv(here::here("dataset/o_MA.csv"))
o_MA %>%
  filter(Dest_state =="Massachusetts")%>% 
  filter(Original_CZ=="Boston") %>%
  ggplot()+
  geom_bar(aes(x = Dest_CZ, fill=Dest_CZ))+
  coord_polar(theta='x')
```

Based on the graph above, we can find out that the number of people who resided in Springfield and the number of people who stayed in Boston are relatively similar, and their populations are the highest among all five community zones. This implies that still the largest percentage of Boston residents tends to stay in Boston. This might be because Boston is the city with the largest population in Massachusetts and seemed to be the most developed. Boston people also are very likely to move to Springfield. This might be because Springfield also has a relatively large population( the third largest city in Massachusetts). 



Moreover The number of people in Pittsburgh is the second largest among all five community zones; the number of people in Oak Bluffs is the third largest among all five community zones; the number of people in Nantucket is the least largest in all community zones. To sum up, the migration trend in Boston is very similar to the total population number in each commute zone. 



***Migration Persona***
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE}
load(here::here("dataset/o_MA.RData"))
chisq_race_income <- chisq.test(o_MA$race, o_MA$income, correct=FALSE)
kable(round(chisq_race_income$residuals, 3))
corrplot(chisq_race_income$residuals, is.cor = FALSE)
```

For the chi-square above, we try to investigate the relationship between race groups and their income level. The graph demonstrates a significant difference of income levels between different races among people who originally migrated from Massachusetts. The result is very informative. The income group can be divided into five levels : Q1( lowest) , Q2, Q3,Q4,and Q5( highest).
We specifically analyze the race group for Q1 and Q5 income groups. For the Q1 group,  it’s mainly occupied by the population of Black and Hispanic, and  the population of White has the lowest percentage in Q1. In the highest income quintile (Q5), it’s mainly occupied by White population group, while the population of Black takes the lowest percentage. Interestly, these two results are perfectly opposite. Moreover, for Asian race group, the population in different income levels are almost equally distributed. For Q1, it has the second lowest percentage of population. Generally, the white race group has higher income and black and hispanic group has the lower income. 


**Race and Income vs. Immigration Pattern By State**
-------
After exploring the the association between race and income and the immigration pattern of Massachusetts, we wondered if the race and income variables would influence the immigration patterns to a larger scope. Thus, we expanded our exploration, focusing on the entire population of the United States.


We conducted analysis of variance (ANOVA) to examine the difference between race in the number of destination migrants, the difference between income levels in the number of destination migrants, and the interaction effect between race and income on the the number of destination migrants. 
```{r message=FALSE, warning=FALSE, include=FALSE}
od_data <- read_csv(here::here("dataset-ignore", "od.csv"))
my_data <- od_data %>%
  filter(o_cz == d_cz) %>%
  mutate(n_tot_d = n_tot_d - n) %>%
  separate(pool,
           into = c("race","income"),
           sep = -2
  )

res.aov2 <- aov(n_tot_d ~ income + race, data = my_data)
summary(res.aov2)

my_data %>% select_if(is.factor)
```

```{r ANOVA, echo=FALSE, message=FALSE, warning=FALSE}
interaction.plot(x.factor = my_data$race, trace.factor = my_data$income, 
                 response = my_data$n_tot_d, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Income", ylab="Migration population in Destinatioj", 
                 trace.label = "Income",
                 pch=c(1,19), col = c("#00AFBB", "#E7B800"))
```


After visualizing the data using a scatter plot, we found that White people with high income tend to migrate to the places with the highest amount of migrant. Asians, regardless of income, tend to gather in places with the least amount of migrant. In addition, Blacks with the lowest income tend to migrate to places with high migrant population, while those with highest income tend to migrate to places with lowest migrant. Hispanics with the lowest income also tend to migrant to places with relatively high migrant population, while those with the highest income tend to migrate to places with low migrants. For Other Races, people with the lowest income tend to move to places with the highest migrant.


To sum up, the places with the most immigrants are likely to be consisted of high income Whites, low income Blacks, low income Hispanics, and people with low income from other races. The places with the least immigrants are likely to be consisted of high income Blacks, high income Hispanics, and Asians. In conclusion, on the premises of people with the similar characteristics and socioeconomic status tend to aggregate, wealthy White people would gather in destinations, which might produce more opportunities for employment, attracting people from other races with low income. On the other hand, places with the majority of wealthy Black and Hispanics might contains less Whites because of the decreased likelihood of finding people of the same kind. Regarding Asians, the majority of them tend to aggregate regardless of income, which might be explained by the collective cultural norm.


**State Income vs. Crime Rate**
-----
Next, we are curious about whether the crime rate has the relationship with race and income.Specifically, we explored the effect of rates of income on the crime rate of each state. We select the dominant income group (from Q1 to Q5) and inspect the relationship between state dominant income group and the crime rate(per 100,000). At the same time, we grouped the states by four geographical regions: Northeast, Midwest, South, and West

```{r include=FALSE}
od_data <- read_csv(here::here("dataset-ignore", "od.csv")) %>%
    separate(pool,
           into = c("race","income"),
           sep = -2
  ) %>%
  filter(n != 0 & n != -1) %>%
  filter(n_tot_o != -1) %>%
  filter(n_tot_d != -1)
od_data[is.na(od_data)] = 0
late_crime <- read.csv(here::here("dataset", "10-17CrimeAvg.csv"))
mean_Robbery <- late_crime %>%
  select(-meanBurglary)
mean_Burglary <- late_crime %>%
  select(-meanRobbery)
state_inc <- od_data %>% 
  group_by(o_state_name,income) %>%
  summarize(inc_n = sum(n)) %>%
  mutate(o_state_name = toupper(o_state_name))
state_maxinc <- state_inc %>%
  group_by(o_state_name) %>%
  filter(inc_n == max(inc_n)) %>%
  mutate(o_state_name = toupper(o_state_name)) %>%
  rename('State' = 'o_state_name')
state_maxinc[state_maxinc == 'DC'] <- 'WASHINGTON'
state_maxinc$State <- gsub(' ','',state_maxinc$State)
state_inc_Rob <- state_maxinc %>%
  inner_join(mean_Robbery,by='State')
state_inc_Rob$income <- gsub('Q','',state_inc_Rob$income)
state_inc_Bur <- state_maxinc %>%
  inner_join(mean_Burglary,by='State') 
state_inc_Bur$income <- gsub('Q','',state_inc_Bur$income)
state_inc_Bur$income <- state_inc_Bur$income %>%as.integer()
NA_State_Reigion<-data.frame(state =c( "Connecticut", "Maine", "Massachusetts", "NewHampshire", "RhodeIsland", "Vermont","NewJersey", "NewYork","Pennsylvania","Illinois", "Indiana", "Michigan", "Ohio", "Wisconsin","Iowa", "Kansas", "Minnesota", "Missouri", "Nebraska", "NorthDakota","SouthDakota","Delaware", "Florida","Georgia", "Maryland","North Carolina", "South Carolina","Virginia", "WashingtonD.C.", "WestVirginia","Alabama", "Kentucky", "Mississippi", "Tennessee","Arkansas", "Louisiana", "Oklahoma", "Texas","Arizona", "Colorado", "Idaho", "Montana", "Nevada", "NewMexico", "Utah", "Wyoming","Alaska", "California", "Hawaii", "Oregon", "Washington"),
                region = c("Northeast","Northeast","Northeast","Northeast","Northeast","Northeast","Northeast","Northeast","Northeast","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest","Midwest"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," South"," West"," West"," West"," West"," West"," West"," West"," West"," West"," West"," West"," West"," West"))

NA_State_Reigion <- NA_State_Reigion %>% 
  mutate(state = toupper(state)) %>%
  rename('State' = 'state')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
lm<-coef(lm(state_inc_Bur$meanBurglary~state_inc_Bur$income))
state_inc_Bur %>%
  inner_join(NA_State_Reigion, by='State') %>%
  ggplot() +
  geom_point(aes(x = income, y = meanBurglary, color = region)) +
  geom_smooth(aes(x = income, y = meanBurglary)) +
  geom_abline(aes(intercept=lm[1],
                  slope=lm[2]),
              color='red',
              linewidth=1) +
  labs(x = 'Income Quantile',y = 'Average Burglary Rate (per 100,000)')
```
From the plot, we find that Q1(the lowest income group) has high Robbery Rate and these states are located in the South region. Q2 dominates the least states which are in the West region. Q4 dominates the most states, it has moderate burglary rate and its dominated states spread acroos all regions. 

The regression result indicates that for 1 increase in the income level(such as from Q1 to Q2), the burglary rate(per 100,000) will decrease by -93.66. The P-value is 1,978e-09, indicating that our linear regression model is appropriate.

**Crime Rate vs. Immigration Patterns**
-----

```{r include=FALSE}
leave <-read_csv(here::here("dataset", "leave.csv"))
movein <- read_csv(here::here("dataset", "movein.csv"))
early <- read_csv(here::here("dataset","00-07CrimeAvg.csv"))
later <- read_csv(here::here("dataset","10-17CrimeAvg.csv"))
early<-early %>% arrange(meanRobbery)
early1<- early %>% arrange(meanBurglary)
later<-later %>% arrange(meanRobbery)
later1<-later %>% arrange(meanBurglary)
```

To explore the correlation between crime rate and immigration decision overall, we started using four subsets of the two datasets. We have subset “leave” representing the proportion of people moved out of each state, subset “movein” representing the proportion of people moved into each state, and subset “early” and “later” containing the average rate of robbery and burglary in the early years and later years. Then we made four plots to explore the correlations.

```{r echo=FALSE}
par(mar=c(5, 4, 4, 6) + 0.1)

plot(early$meanRobbery, pch=16, axes=FALSE, ylim=c(0,650), xlab="", ylab="", 
   type="l",col="darkorchid4", main="Early years robbery rate vs people move out of the states")
axis(2, ylim=c(0,1),col="darkorchid4",col.axis="darkorchid4",las=1)  ## las=1 makes horizontal labels
mtext("Robbery rate per 100,000",side=2,col="darkorchid4",line=2.5)
box()
par(new=TRUE)
plot(leave$prop_leave, pch=15,  xlab="", ylab="", ylim=c(0.05,0.45), 
    axes=FALSE, type="l", col="coral")

mtext("Proportion of people left the state",side=4,col="coral",line=4) 
axis(4, ylim=c(0,7000), col="coral",col.axis="coral",las=1)

mtext("states",side=1,col="darkorchid4",line=2.5)  

legend("topleft",legend=c("Robbery","Proportion left"),
  text.col=c("darkorchid4","coral"),pch=c(16,15),col=c("darkorchid4","coral"))
```

```{r echo=FALSE}
par(mar=c(5, 4, 4, 6) + 0.1)

plot(later$meanRobbery, pch=16, axes=FALSE, ylim=c(0,230), xlab="", ylab="", 
   type="l",col="deepskyblue3", main="later years robbery rate vs people move into the states")
axis(2, ylim=c(0,1),col="deepskyblue3",col.axis="deepskyblue3",las=1)  ## las=1 makes horizontal labels
mtext("Robbery rate per 100,000",side=2,col="deepskyblue3",line=2.5)
box()

par(new=TRUE)

plot(movein$prop_movein, pch=15,  xlab="", ylab="", ylim=c(0,0.5), 
    axes=FALSE, type="l", col="darkorange1")

mtext("Proportion of people moved into the states",side=4,col="darkorange1",line=4) 
axis(4, ylim=c(0,7000), col="darkorange1",col.axis="darkorange1",las=1)

mtext("states",side=1,col="deepskyblue3",line=2.5)  

legend("topleft",legend=c("Robbery","Proportion moved in"),
  text.col=c("deepskyblue3","darkorange1"),pch=c(16,15),col=c("deepskyblue3","darkorange1"))
```

Looking at these two figures, we can see that states with higher robbery rates do not usually have a higher moving in/moving out rate. As the robbery rate goes up by different states, the curve for moving in/moving out rate oscillates around the rate of approximately 0.25. 

```{r echo=FALSE}
par(mar=c(5, 4, 4, 6) + 0.1)

plot(early1$meanBurglary, pch=16, axes=FALSE, ylim=c(250,1250), xlab="", ylab="", 
   type="l",col="darkorchid4", main="Early years burglary rate vs people left the states")
axis(2, ylim=c(0,1),col="darkorchid4",col.axis="darkorchid4",las=1)  ## las=1 makes horizontal labels
mtext("Burglary rate per 100,000",side=2,col="darkorchid4",line=2.5)
box()

par(new=TRUE)

plot(leave$prop_leave, pch=15,  xlab="", ylab="", ylim=c(0.1,0.45), 
    axes=FALSE, type="l", col="firebrick1")

mtext("Proportion of people left the state",side=4,col="firebrick1",line=4) 
axis(4, ylim=c(0,7000), col="firebrick1",col.axis="firebrick1",las=1)

mtext("states",side=1,col="darkorchid4",line=2.5)  

legend("topleft",legend=c("Burglary","Proportion left"),
  text.col=c("darkorchid4","firebrick1"),pch=c(16,15),col=c("darkorchid4","firebrick1"))
```

```{r echo=FALSE}
par(mar=c(5, 4, 4, 6) + 0.1)

plot(later1$meanBurglary, pch=16, axes=FALSE, ylim=c(300,1100), xlab="", ylab="", 
   type="l",col="deepskyblue3", main="Later years burglary vs people moved into the states")
axis(2, ylim=c(0,1),col="deepskyblue3",col.axis="deepskyblue3",las=1)  ## las=1 makes horizontal labels
mtext("Burglary rate per 100,000",side=2,line=2.5,col = 'deepskyblue3')
box()

par(new=TRUE)

plot(movein$prop_movein, pch=15,  xlab="", ylab="", ylim=c(0.1,0.5), 
    axes=FALSE, type="l", col="darkolivegreen4")

mtext("Proportion of people moved into the states",side=4,col="darkolivegreen4",line=4) 
axis(4, ylim=c(0,7000), col="darkolivegreen4",col.axis="darkolivegreen4",las=1)

mtext("states",side=1,col="deepskyblue3",line=2.5)  

legend("topright",legend=c("Burglary","Proportion moved in"),
  text.col=c("deepskyblue3","darkolivegreen4"),pch=c(16,15),col=c("deepskyblue3","darkolivegreen4"))
```

From these two figures above about the effect of burglary on people’s moving decisions, we can see that states with higher burglary rates do not usually have a higher moving in/moving out rate. As the robbery rate goes up by different states, the curve for the moving in/moving out rate oscillates. Compared to the robbery graphs, the graphs of burglary comparison show more variability for the proportion of people moving in/out.


In conclusion, from the four graphs shown above, we can say that there is no correlation between robbery and burglary rates and immigration decisions overall if we only look at the migration pattern between states. The graphs do not show any obvious migration pattern as the crime rates go up. This is different from what we expected since our original hypothesis was the higher the crime rates are, the higher the moving-out rate it would be(the lower the moving-in rate would be). We would normally assume that higher robbery and burglary rate meaning people would not feel safe to live there. But in this case we ignored some key factors. For example, we used states as unit to explore the correlation between crime rate and immigration decision overall. However crime rate and migration pattern between cities can be very different as well. People might choose to move within the state if they find the crime rate in their cities are too high. Also, there are more factors that could affect both crime rate and immigration decisions that we are not considering such as the economic development level, work opportunities and tourism.

**Discussion And Future Research**
-------
Our results indicate that certain patterns exists between race, income, and immigration status of the state, but the robbery and burglary rate have no influence on immigration patterns. This research only explore the correlation between two variables. In future research, we can study the reason behind these correlations. e.g. income vs. satisfaction/life quality etc. 

We try to avoid making conclusions for races because samples population are dominated by white in the dataset, thus the result may be biased. Sample number of non-white immigrants in the dataset is not sufficient to become representative for their races. Our future study would required dataset with more balanced race percentages. 

Besides race, income, and crime rate, there are many other factors that could affect the immigration status of the state. Instead of finding patterns from a single variable, we could perform multivariate analysis to examine more sophiscated factors that could affect the immigration status. 